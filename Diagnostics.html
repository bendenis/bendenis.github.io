<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Ben Denis Shaffer" />


<title>STATS_500_HW_4</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<link href="site_libs/ionicons-2.0.1/css/ionicons.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="ion ion-ios-pulse"></span>
     
    STATS 500
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="about_stl1.html">About</a>
    </li>
    <li>
      <a href="EDA.html">EDA</a>
    </li>
    <li>
      <a href="SLM.html">SLM</a>
    </li>
    <li>
      <a href="MLM.html">MLM</a>
    </li>
    <li>
      <a href="Diagnostics.html">Diagnostics</a>
    </li>
    <li>
      <a href="Robust_Regression.html">Robust Regression</a>
    </li>
    <li>
      <a href="Response_Transpormations.html">Transformations</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-laptop"></span>
     
    STATS 506
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="about_comp.html">About</a>
    </li>
    <li>
      <a href="STATS_506_HW_1.html">HW_1</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-map"></span>
     
    BIOSTAT 696
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="about_spatial.html">About</a>
    </li>
    <li>
      <a href="BIOSTAT_HW_1.html">HW1</a>
    </li>
    <li>
      <a href="BIOSTAT_696_HW4.html">HW4</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://medium.com/@bendenisshaffer">
    <span class="fa fa-medium"></span>
     
    Blog
  </a>
</li>
<li>
  <a href="https://www.linkedin.com/in/ben-denis-shaffer-16291140">
    <span class="fa fa-linkedin"></span>
     
    LinkedIn
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">STATS_500_HW_4</h1>
<h4 class="author"><em>Ben Denis Shaffer</em></h4>
<h4 class="date"><em>October 7, 2016</em></h4>

</div>


<pre><code>## The following objects are masked from teengamb (pos = 11):
## 
##     gamble, income, sex, status, verbal</code></pre>
<p>When proforming standard regression analysis certain assumptions about the stucture and distribution of the data at hand are made. The inferences made from the model are only valid if the assumptions are true. Thus we employ diagnostic methedologies to evaluate whether assumptions are not grossly violated, and that infrences may be made.</p>
<div id="model-diagnostics" class="section level3">
<h3>Model Diagnostics</h3>
<p>Our model loks at how teenage gambling relates to covariates such as income, social status, gender, and preformance on the verbal score. We begin by using a siple multivariate linear regression:</p>
<pre class="r"><code>model &lt;- lm(gamble ~ sex + status + income + verbal)
model</code></pre>
<pre><code>## 
## Call:
## lm(formula = gamble ~ sex + status + income + verbal)
## 
## Coefficients:
## (Intercept)          sex       status       income       verbal  
##    22.55565    -22.11833      0.05223      4.96198     -2.95949</code></pre>
<p>We then proceed to check the following assumptions: <em>Constant Variance </em>Normality *Independent Residuals (This analysis is left for later)</p>
<pre class="r"><code>plot(model$residuals ~ model$fitted.values, xlab = &quot;Fitted Values&quot;, ylab = &quot;Residuals&quot;, main = &quot;Risiduals vs Fitted Values&quot;)</code></pre>
<p><img src="Diagnostics_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>The plot above raises the suspicion on non-constant variance. We see how residuals first decrease and then increase in what appears to be a systematic fashion. To remedy this we propose a different model with a transformation applied to the responce, amount gambled.</p>
<pre class="r"><code>model2 &lt;- lm(log(gamble+1) ~ sex + status + income + verbal)
model2</code></pre>
<pre><code>## 
## Call:
## lm(formula = log(gamble + 1) ~ sex + status + income + verbal)
## 
## Coefficients:
## (Intercept)          sex       status       income       verbal  
##     1.71620     -0.87120      0.02983      0.21565     -0.26165</code></pre>
<p>Now we can see that the residuals seem to fluctuate around zero with no strong pattern, equal deviations across the fitted values. The plot is not perfect but good enough to make a judgment in favor of constant variance.</p>
<pre class="r"><code>plot(model2$residuals ~ model2$fitted.values, xlab = &quot;Fitted Values&quot;, ylab = &quot;Residuals&quot;, main = &quot;Risiduals vs Fitted Values&quot;)</code></pre>
<p><img src="Diagnostics_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>To check normality we construct a qqplot, coparing the empirical quantiles of the residuals to the standard normal quantiles. As seen from the plot, the empirical quantiles seem to follow the normal quantiles relativly closely, and with no string deviations at the tails. Thus it appears that normality is not stringly violated.</p>
<pre class="r"><code>par(mfrow = c(1,2))

qqnorm(model2$residuals)
qqline(model2$residuals, col=2, lty = 2)

plot(density(model2$residuals), main = &quot;Empirical vs Simulated&quot;, xlab = &quot;&quot;)
lines(density(rnorm(10000)), col=2, lty=2)</code></pre>
<p><img src="Diagnostics_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>After checking some of the important assumptions we want to check for unusual observations that could be either heavily influencing the model fit, or our inferences. We want to check for: <em>Leverage Points </em>Outliers</p>
<p>Evaluation of leverage allows to see which data poins are driving the model fit. These points are ones that are far removed from the main mass of the data.</p>
<pre class="r"><code>plot(sort(lm.influence(model2)$hat), main = &quot;Leverage with cutoff&quot;, ylab = &quot;Sorted Hat Diagonal&quot;)
abline(h = 2*(dim(teengamb)[2]+1)/dim(teengamb)[1], col = 2, lty = 2)</code></pre>
<p><img src="Diagnostics_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code>teengamb[(lm.influence(model2)$hat) &gt; 2*(dim(teengamb)[2]+1)/dim(teengamb)[1],]</code></pre>
<pre><code>##    sex status income verbal gamble
## 35   0     28    1.5      1   14.1
## 42   0     61   15.0      9   69.7</code></pre>
<p>These are the two points with what would be considered high leverage.</p>
<p>In contrast, outliers are points that heavily infuelnce the “goodness of fit”, and hence the infirences drawn about the parameters. The “Jacknife” residuals measures how much the fitted values change having removed one of the data points at a time. These residuals are tested against a distribution to derive the likelihood of observing a change in fitted values. Because we preform multiple tests simultaniously we use the Bonferroni adjusted error rate. If the test is significant, the data suggests the point is an outlier. Based on the test we don’t identify any outliers.</p>
<pre class="r"><code>pvalues &lt;- (1-pt(abs(rstudent(model2)), df = dim(teengamb)[1] - dim(teengamb)[2] - 1))*2
plot(pvalues, ylim = c(0,0.20), ylab = &quot;p-value&quot;, main = &quot;Testing Outliers, Bonferroni Adjustment&quot;)
abline(h = 0.05/47, col = 2, lty = 2)</code></pre>
<p><img src="Diagnostics_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="prediction" class="section level3">
<h3>Prediction</h3>
<p>Now we use our model to predict the amount gambled, on the log scale, for a range of different levels of income. On the preiction plot you can also see the confidence and prediction bounds. The pink points are the points with large leverage. The yellow points are onse that are most likley to be outliers.</p>
<pre class="r"><code>pred &lt;- predict( model2, data.frame(sex = 0, status = 43, income = 0:20, verbal =7), interval = c(&quot;prediction&quot;))
conf &lt;- predict( model2, data.frame(sex = 0, status = 43, income = 0:20, verbal =7), interval = c(&quot;confidence&quot;))

plot(income,log(gamble + 1), xlim = c(-1,20), ylim = c(-1,8), ylab = &quot;LOG Amount Gambled&quot;, xlab = &quot;Income&quot;, main = &quot;Predicting Amount Gambled using Income&quot;)
rug(income, col=2)
lines(pred[,&quot;fit&quot;], col=2)
lines(pred[,&quot;lwr&quot;], lty=2, col=3)
lines(pred[,&quot;upr&quot;], lty=2, col=3)
lines(conf[,&quot;lwr&quot;], lty=3, col=4)
lines(conf[,&quot;upr&quot;], lty=3, col=4)
points(income,log(gamble + 1), col = ifelse(gamble == 69.7| gamble == 14.1, 6,1), pch = ifelse(gamble == 69.7 | gamble == 14.1, 20,1))

points(income,log(gamble + 1), col = ifelse(gamble == 0.1| gamble == 19.6 | gamble == 6.0| gamble == 70, 7,1), pch = ifelse(gamble == 0.1| gamble == 19.6 | gamble == 6.0| gamble == 70, 20,1))</code></pre>
<p><img src="Diagnostics_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
